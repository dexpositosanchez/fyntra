<div class="incidencias-container">
  <header class="app-header">
    <div class="header-left">
      <div class="logo-section">
        <img src="/assets/images/Isotipo.png" alt="Fyntra" class="logo-isotipo" />
      </div>
      <nav class="main-nav">
        <a routerLink="/propietarios" class="nav-link" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">PROPIETARIOS</a>
        <a routerLink="/propiedades" class="nav-link" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">PROPIEDADES</a>
        <a routerLink="/comunidades" class="nav-link" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">COMUNIDADES</a>
        <a routerLink="/incidencias" class="nav-link" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">INCIDENCIAS</a>
        <a routerLink="/proveedores" class="nav-link" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">PROVEEDORES</a>
      </nav>
    </div>
    <div class="user-section">
      <div class="user-menu-container">
        <button class="user-menu-button" (click)="toggleMenuUsuario()" title="Menú de usuario">
          <span class="user-icon app-icon">person</span>
          <span class="user-name">{{ usuario?.nombre || 'Usuario' }}</span>
          <span class="dropdown-arrow">{{ mostrarMenuUsuario ? '▲' : '▼' }}</span>
        </button>
        <div class="user-menu-dropdown" *ngIf="mostrarMenuUsuario">
          <button class="menu-item" *ngIf="estaEnModuloTransportes()" (click)="cambiarAModuloFincas()">
            <span class="menu-icon app-icon">apartment</span>
            <span>Módulo Fincas</span>
          </button>
          <button class="menu-item" *ngIf="!estaEnModuloTransportes()" (click)="cambiarAModuloTransportes()">
            <span class="menu-icon app-icon">local_shipping</span>
            <span>Módulo Transportes</span>
          </button>
          <div class="menu-divider" *ngIf="estaEnModuloTransportes() || !estaEnModuloTransportes()"></div>
          <button class="menu-item logout-item" (click)="logout()">
            <span class="menu-icon app-icon">logout</span>
            <span>Salir</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <main class="main-content">
    <!-- Sección de Incidencias -->
    <div *ngIf="currentRoute.includes('/incidencias')">
      <div class="filters-section">
        <button class="filter-button">
          <span>Fecha</span>
          <span class="icon app-icon">calendar_month</span>
        </button>
        <button class="filter-button">
          <span>Prioridad</span>
          <span class="icon">▼</span>
        </button>
      </div>

      <div class="table-container">
        <h2 class="table-title">INCIDENCIAS SIN RESOLVER</h2>
        
        <div *ngIf="loading" class="loading">Cargando...</div>
        <div *ngIf="error" class="error">{{ error }}</div>
        
        <table class="incidencias-table" *ngIf="!loading && !error">
          <thead>
            <tr>
              <th>Prioridad <span class="sort-icon">▼</span></th>
              <th>Fecha <span class="sort-icon">▼</span></th>
              <th>Finca <span class="sort-icon">▼</span></th>
              <th>Propiedad <span class="sort-icon">▼</span></th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let incidencia of incidencias">
              <td>
                <span [class]="'prioridad-badge ' + getPrioridadClass(incidencia.prioridad)">
                  {{ getPrioridadTexto(incidencia.prioridad) }}
                </span>
              </td>
              <td>{{ formatearFecha(incidencia.fecha_alta) }}</td>
              <td>{{ incidencia.inmueble?.comunidad?.nombre || 'Finca Prueba' }}</td>
              <td>{{ incidencia.inmueble?.referencia || 'Propiedad Prueba' }}</td>
              <td class="actions-cell">
                <button class="action-btn view-btn" (click)="verDetalle(incidencia.id)" title="Ver detalle">
                  <span class="app-icon">search</span>
                </button>
                <button class="action-btn resolve-btn" (click)="resolver(incidencia.id)" title="Resolver">
                  <span class="app-icon">check</span>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Secciones placeholder para otras rutas -->
    <div *ngIf="currentRoute.includes('/propietarios')" class="table-container">
      <h2 class="table-title">PROPIETARIOS</h2>
      <p class="placeholder-text">Gestión de propietarios - Próximamente</p>
    </div>

    <div *ngIf="currentRoute.includes('/propiedades')" class="table-container">
      <h2 class="table-title">PROPIEDADES</h2>
      <p class="placeholder-text">Gestión de propiedades - Próximamente</p>
    </div>

    <div *ngIf="currentRoute.includes('/comunidades')" class="table-container">
      <h2 class="table-title">COMUNIDADES</h2>
      <p class="placeholder-text">Gestión de comunidades - Próximamente</p>
    </div>

    <div *ngIf="currentRoute.includes('/proveedores')" class="table-container">
      <h2 class="table-title">PROVEEDORES</h2>
      <p class="placeholder-text">Gestión de proveedores - Próximamente</p>
    </div>
  </main>
</div>

